<?xml version="1.0" standalone="yes"?>


<Instruments xmlns="instruments.xmlbeans.model.fc.lmn.org"
             xmlns:md="metadata.xmlbeans.model.fc.lmn.org">


    <!-- ....................................................................................... -->
    <!-- Magnetometer -->

    <Instrument>
        <Identifier>MagnetometerAutoNull</Identifier> <!-- CHANGED -->

        <!-- ................................................................................... -->
        <!-- The Magnetometer Controller -->

        <Controller>
            <!-- A placeholder for the discovered address on Staribus, or an address already assigned -->
            <!-- Three DECIMAL digits, range {001...254} -->
            <StaribusAddress>005</StaribusAddress>  <!-- CHANGED -->

            <!-- ............................................................................... -->
            <!-- Instrument (Primary Plugins) -->
            <!-- ............................................................................... -->
            <!-- Allow Parent to Child links to identify those physical Plugins **required** for this Instrument -->
            <!-- The schema allows for zero Plugins -->

            <PluginManifest>
                <!-- The Key for the PrimaryPlugin, which defines the nature of the Instrument -->
                <PrimaryResourceKey>MagnetometerPlugin</PrimaryResourceKey>

                <!-- There are no Secondary Plugins for this Instrument -->
            </PluginManifest>

            <Identifier>Core</Identifier>
            <Name>Core</Name>
            <Description>The Magnetometer Core</Description>
            <ResourceKey>Core</ResourceKey>

            <!-- ............................................................................... -->
            <!-- Generic (Mandatory) Commands -->

            <!-- The Core has a CommandCodeBase of zero -->
            <!-- All Core CommandVariants are zero -->
            <CommandCodeBase>00</CommandCodeBase>

            <!-- reset() returns the Controller to its initialised state -->
            <Command>
                <Identifier>reset</Identifier>
                <CommandCode>00</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <Description>Resets the Controller</Description>
                <CommandMetadata>
                    <md:Key>Instrument.Core.Reset.Timeout</md:Key>
                    <md:Value>20</md:Value>
                    <md:DataTypeName>DecimalInteger</md:DataTypeName>
                    <md:Units>Seconds</md:Units>
                    <md:Description>The time allowed for reset() to complete</md:Description>
                </CommandMetadata>
                <Parameter>
                    <Name>Reset.Mode</Name>
                    <InputDataType>
                        <DataTypeName>String</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>NumericIndexedList</DataTypeName>
                        <FieldCount>1</FieldCount>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Choices>Soft,Defaults,Staribus</Choices>
                    <Tooltip>Allowed values: Soft, Defaults, Staribus</Tooltip>
                </Parameter>
                <SendToPort>true</SendToPort>
                <Ack>
                    <Name>Ack</Name>
                </Ack>
            </Command>

            <!-- ping() indicates if a Controller is connected at this address -->
            <Command>
                <Identifier>ping</Identifier>
                <CommandCode>01</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <Description>Pings the Controller</Description>
                <SendToPort>true</SendToPort>
                <Ack>
                    <Name>Ack</Name>
                </Ack>
            </Command>

            <!-- getConfiguration() reads the memories of all connected Modules, -->
            <!-- and forms the XML configuration of the composite Instrument -->
            <!-- This Command is executed entirely on the host -->
            <Command>
                <Identifier>getConfiguration</Identifier>
                <CommandCode>02</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <!-- Obtain the assembled XML data by iterating this 'macro' -->
                <!-- Core.getModuleConfiguration() -->
                <SteppedDataCommand>
                    <SteppedCommandCodeBase>00</SteppedCommandCodeBase>
                    <SteppedCommandCode>03</SteppedCommandCode>
                </SteppedDataCommand>
                <Description>Gets the assembled XML configuration of the Instrument</Description>
                <SendToPort>false</SendToPort>
                <Response>
                    <Name>Configuration.XML</Name>
                    <DataTypeName>XML</DataTypeName>
                    <Units>Dimensionless</Units>
                </Response>
            </Command>

            <!-- getModuleConfiguration() first uses getConfigurationBlockCount() to get the number of blocks -->
            <!-- then iterates over getConfigurationBlock() to get all blocks from the specified ModuleID -->
            <!-- These sub-commands are specified through the use of the <BlockedDataCommand> element -->
            <!-- If a Module is missing, then the ResponseValue must be 'NODATA' -->
            <Command>
                <Identifier>getModuleConfiguration</Identifier>
                <CommandCode>03</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <!-- The SteppedCommand ParentCommandCode is missing because the BlockedData is more important! -->
                <BlockedDataCommand>
                    <BlockCountCommandCode>05</BlockCountCommandCode>
                    <BlockCommandCode>06</BlockCommandCode>
                </BlockedDataCommand>
                <Description>Gets the Module configuration data, as an XML fragment</Description>
                <Parameter>
                    <Name>Configuration.ModuleID</Name>
                    <InputDataType>
                        <DataTypeName>DecimalInteger</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>String</DataTypeName>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Regex>[0-7]</Regex>
                    <Tooltip>Allowed Values: ModuleID 0 to 7</Tooltip>
                </Parameter>
                <SendToPort>false</SendToPort>
                <Response>
                    <Name>Configuration.Module</Name>
                    <DataTypeName>XML</DataTypeName>
                    <Units>Dimensionless</Units>
                </Response>
            </Command>

            <!-- setModuleConfiguration() iterates over setConfigurationBlock() -->
            <!-- to set all blocks in the specified ModuleID, -->
            <!-- using the configuration data in the specified filename -->
            <!-- These sub-commands are specified through the use of the <BlockedDataCommand> element -->
            <!-- This Command is executed entirely on the host -->
            <Command>
                <Identifier>setModuleConfiguration</Identifier>
                <CommandCode>04</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <!-- Set the Module XML configuration data by iterating this 'macro' -->
                <!-- Core.setConfigurationBlock() -->
                <SteppedDataCommand>
                    <SteppedCommandCodeBase>00</SteppedCommandCodeBase>
                    <SteppedCommandCode>07</SteppedCommandCode>
                </SteppedDataCommand>
                <Description>Sets the Module configuration data, as an XML fragment</Description>
                <Parameter>
                    <Name>Configuration.ModuleID</Name>
                    <InputDataType>
                        <DataTypeName>DecimalInteger</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>String</DataTypeName>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Regex>[0-7]</Regex>
                    <Tooltip>Allowed Values: ModuleID 0 to 7</Tooltip>
                </Parameter>
                <Parameter>
                    <Name>Configuration.Filename</Name>
                    <InputDataType>
                        <DataTypeName>FileName</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>String</DataTypeName>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Value>workspace/configuration</Value>
                    <!-- ToDo Regex -->
                    <Tooltip>The pathname/filename containing the configuration XML</Tooltip>
                </Parameter>
                <Parameter>
                    <Name>CompressedFormat</Name>
                    <InputDataType>
                        <DataTypeName>Boolean</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>Boolean</DataTypeName>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Choices>false,true</Choices>
                    <Tooltip>Allowed values: true or false This removes all unnecessary characters from the XML</Tooltip>
                </Parameter>
                <SendToPort>false</SendToPort>
                <Ack>
                    <Name>Ack</Name>
                </Ack>
            </Command>

            <!-- getConfigurationBlockCount() counts the number of blocks of data in the Module memory -->
            <!-- getConfigurationBlockCount() refers to its parent getModuleConfiguration() -->
            <!-- through the <ParentCommandCode> element -->
            <Command>
                <Identifier>getConfigurationBlockCount</Identifier>
                <CommandCode>05</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <BlockedDataCommand>
                    <ParentCommandCode>03</ParentCommandCode>
                </BlockedDataCommand>
                <Description>Gets the number of blocks of data in the Module configuration</Description>
                <CommandMetadata>
                    <md:Key>Instrument.Core.GetConfigurationBlockCount.Timeout</md:Key>
                    <md:Value>30</md:Value>
                    <md:DataTypeName>DecimalInteger</md:DataTypeName>
                    <md:Units>Seconds</md:Units>
                    <md:Description>The time allowed for getConfigurationBlockCount() to complete</md:Description>
                </CommandMetadata>
                <Parameter>
                    <Name>Configuration.ModuleID</Name>
                    <InputDataType>
                        <DataTypeName>DecimalInteger</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>String</DataTypeName>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Regex>[0-7]</Regex>
                    <Tooltip>Allowed Values: ModuleID 0 to 7</Tooltip>
                </Parameter>
                <SendToPort>true</SendToPort>
                <Response>
                    <Name>Configuration.BlockCount</Name>
                    <DataTypeName>HexInteger</DataTypeName>
                    <Units>Dimensionless</Units>
                    <Regex>[0-9A-Fa-f][0-9A-Fa-f][0-9A-Fa-f][0-9A-Fa-f]</Regex>
                </Response>
            </Command>

            <!-- getConfigurationBlock() obtains the configuration data in the specified Module memory -->
            <!-- getConfigurationBlock() refers to its parent getModuleConfiguration() -->
            <!-- through the <ParentCommandCode> element -->
            <Command>
                <Identifier>getConfigurationBlock</Identifier>
                <CommandCode>06</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <BlockedDataCommand>
                    <ParentCommandCode>03</ParentCommandCode>
                </BlockedDataCommand>
                <Description>Gets the specified block of Module configuration data, as an XML fragment</Description>
                <Parameter>
                    <Name>Configuration.ModuleID</Name>
                    <InputDataType>
                        <DataTypeName>DecimalInteger</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>String</DataTypeName>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Regex>[0-7]</Regex>
                    <Tooltip>Allowed Values: ModuleID 0 to 7</Tooltip>
                </Parameter>
                <Parameter>
                    <Name>Configuration.BlockID</Name>
                    <InputDataType>
                        <DataTypeName>HexInteger</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>String</DataTypeName>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Regex>(00[0-6][0-9A-Fa-f])|(00[7][0-9A-E])</Regex>
                    <Tooltip>Allowed Values: BlockID 0000 to 007E</Tooltip>
                </Parameter>
                <SendToPort>true</SendToPort>
                <Response>
                    <Name>Configuration.Block</Name>
                    <DataTypeName>String</DataTypeName>
                    <Units>Dimensionless</Units>
                    <Regex>^(\p{Graph}|\x20|\x03){512}$</Regex>
                </Response>
            </Command>

            <!-- setConfigurationBlock() sets the configuration data in the specified Module memory -->
            <!-- setConfigurationBlock() refers to its parent setModuleConfiguration() -->
            <!-- through the <ParentCommandCode> element -->
            <Command>
                <Identifier>setConfigurationBlock</Identifier>
                <CommandCode>07</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <SteppedDataCommand>
                    <ParentCommandCodeBase>00</ParentCommandCodeBase>
                    <ParentCommandCode>04</ParentCommandCode>
                </SteppedDataCommand>
                <Description>Sets the specified block of Module configuration data</Description>
                <Parameter>
                    <Name>Configuration.ModuleID</Name>
                    <InputDataType>
                        <DataTypeName>DecimalInteger</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>String</DataTypeName>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Regex>[0-7]</Regex>
                    <Tooltip>Allowed Values: ModuleID 0 to 7</Tooltip>
                </Parameter>
                <Parameter>
                    <Name>Configuration.BlockID</Name>
                    <InputDataType>
                        <DataTypeName>HexInteger</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>String</DataTypeName>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Regex>(00[0-6][0-9A-Fa-f])|(00[7][0-9A-E])</Regex>
                    <Tooltip>Allowed Values: BlockID 0000 to 007E</Tooltip>
                </Parameter>
                <Parameter>
                    <Name>Configuration.Data</Name>
                    <InputDataType>
                        <DataTypeName>String</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>String</DataTypeName>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Regex>^(\p{Graph}|\x20|\x03){512}$</Regex>
                    <Tooltip>The data must contain exactly 512 ASCII characters</Tooltip>
                </Parameter>
                <SendToPort>true</SendToPort>
                <Ack>
                    <Name>Ack</Name>
                </Ack>
            </Command>

            <!-- ............................................................................... -->
            <!-- Core Commands executed entirely on the host -->

            <!-- start() starts the Instrument, exactly as for the ControlPanel green button -->
            <!-- This is required for the Macro support -->
            <Command>
                <Identifier>start</Identifier>
                <CommandCode>08</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <Description>Starts the Instrument</Description>
                <SendToPort>false</SendToPort>
                <Response>
                    <Name>Ack</Name>
                    <DataTypeName>String</DataTypeName>
                    <Units>Dimensionless</Units>
                    <Regex>Ok</Regex>
                </Response>
            </Command>

            <!-- stop() stops the Instrument, exactly as for the ControlPanel red button -->
            <!-- This is required for the Macro support -->
            <Command>
                <Identifier>stop</Identifier>
                <CommandCode>09</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <Description>Stops the Instrument</Description>
                <SendToPort>false</SendToPort>
                <Response>
                    <Name>Ack</Name>
                    <DataTypeName>String</DataTypeName>
                    <Units>Dimensionless</Units>
                    <Regex>Ok</Regex>
                </Response>
            </Command>

            <!-- getVersion() returns a String giving the version information for the Controller OS -->
            <Command>
                <Identifier>getVersion</Identifier>
                <CommandCode>0A</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <Description>Gets the Version of the Controller OS</Description>
                <SendToPort>true</SendToPort>
                <Response>
                    <Name>Configuration.Version</Name>
                    <DataTypeName>String</DataTypeName>
                    <Units>Dimensionless</Units>
                </Response>
            </Command>


            <!-- Get the Staribus Address of the Controller -->
            <Command>
                <Identifier>getStaribusAddress</Identifier>
                <CommandCode>0B</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <Description>Gets the Staribus Address of the Controller - Module ID 0</Description>
                <SendToPort>false</SendToPort>
                <Response>
                    <Name>Configuration.Address.Staribus</Name>
                    <DataTypeName>String</DataTypeName>
                    <Units>Dimensionless</Units>
                    <Regex>^0*([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-3])$</Regex>
                </Response>
            </Command>

            <!-- Set the Staribus Address of the Controller -->
            <Command>
                <Identifier>setStaribusAddress</Identifier>
                <CommandCode>0C</CommandCode>
                <CommandVariant>0000</CommandVariant>
                <Description>Sets the Staribus Address of the Controller - Module ID 0</Description>
                <Parameter>
                    <Name>Configuration.Address.Staribus</Name>
                    <InputDataType>
                        <DataTypeName>DecimalInteger</DataTypeName>
                    </InputDataType>
                    <TrafficDataType>
                        <DataTypeName>String</DataTypeName>
                    </TrafficDataType>
                    <Units>Dimensionless</Units>
                    <Regex>^0*([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-3])$</Regex>
                    <Tooltip>Allowed Values: 000 to 253</Tooltip>
                </Parameter>
                <SendToPort>false</SendToPort>
                <Response>
                    <Name>Ack</Name>
                    <DataTypeName>String</DataTypeName>
                    <Units>Dimensionless</Units>
                    <Regex>Ok</Regex>
                </Response>
            </Command>

            <!-- ............................................................................... -->
            <!-- Each Controller may have zero or more Plugins, up to the I2C bus addressing limit -->
            <!-- Some Plugins are 'virtual', i.e. do not relate to separate I2C devices -->
            <!-- for example, the processor on-chip services such as A2D and D2A -->

            <!-- ............................................................................... -->
            <!-- DataProcessor Plugin -->

            <Plugin>
                <!-- A virtual Plugin -->
                <Identifier>DataProcessor</Identifier>
                <Name>DataProcessor</Name>
                <Description>The DataProcessor Module</Description>
                <ResourceKey>DataProcessor</ResourceKey>

                <!-- The DataProcessor Plugin is always CommandCodeBase 50 -->
                <CommandCodeBase>50</CommandCodeBase>

                <Command>
                    <Identifier>applyFilter</Identifier>
                    <CommandCode>00</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Apply a Filter to the selected dataset</Description>
                    <Parameter>
                        <Name>Filter.Name</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>!FilterList</Choices>
                        <Tooltip>Select a Filter to apply to the RawData to create ProcessedData</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>ApplyTo.ChannelID</Name>
                        <InputDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Tooltip>Any Channel ID for the current dataset, or -1, to apply to all channels</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>ApplyTo.Dataset</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>RawData,ProcessedData</Choices>
                        <Tooltip>Allowed values: RawData,ProcessedData</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>segmentTimeSeries</Identifier>
                    <CommandCode>01</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Segment a Time Series into a set of files</Description>
                    <Parameter>
                        <Name>Segment.Size</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>Day,Daytime,Hour,Minute</Choices>
                        <Tooltip>Allowed values: Day,Daytime,Hour,Minute</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Pathname</Name>
                        <InputDataType>
                            <DataTypeName>PathName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive</Value>
                        <Tooltip>The pathname used for saving the individual files e.g. archive</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Choices>
                        <Tooltip>Allowed values: CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>ApplyTo.Dataset</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>RawData</Choices>
                        <Tooltip>Allowed values: RawData</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>evalTemperatureCorrelation</Identifier>
                    <CommandCode>02</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <!-- See: http://en.wikipedia.org/wiki/Correlation_and_dependence -->
                    <Description>Calculate Pearson Correlation Coefficient between Temperature and Data</Description>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>CorrelationCoefficients</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                    </Response>
                </Command>

            </Plugin>

            <!-- ............................................................................... -->
            <!-- DataCapture Plugin -->

            <Plugin>
                <!-- A virtual Plugin -->
                <Identifier>DataCapture</Identifier>
                <Name>DataCapture</Name>
                <Description>The DataCapture Module</Description>
                <ResourceKey>DataCapture</ResourceKey>

                <!-- Configuration Metadata specific to this Plugin, for defining the Data -->
                <!-- Each Channel must be completely defined, in order to allow the data to be parsed -->
                <!-- Provide: Name, DataType, Units and Description -->
                <!-- The Metadata Keys, DataTypes and Units MUST agree with the Starbase dictionary! -->

                <!-- Tell Starbase how many channels to expect in the realtime StaribusMultichannelData -->
                <!-- This must include the slow-speed Temperature channel, if present -->
                <PluginMetadata>
                    <md:Key>Observation.Channel.Count</md:Key>
                    <md:Value>3</md:Value>
                    <md:DataTypeName>DecimalInteger</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The number of channels of data produced by this Instrument</md:Description>
                </PluginMetadata>

                <!-- The slow-speed Temperature Channel -->
                <PluginMetadata>
                    <md:Key>Observation.Channel.Name.Temperature</md:Key>
                    <md:Value>Temperature</md:Value>
                    <md:DataTypeName>String</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The name of the Temperature channel</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.DataType.Temperature</md:Key>
                    <md:Value>DecimalFloat</md:Value>
                    <md:DataTypeName>DataType</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The DataType of the Temperature channel</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.Units.Temperature</md:Key>
                    <md:Value>Celsius</md:Value>
                    <md:DataTypeName>Units</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The Units of the Temperature channel</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.Description.Temperature</md:Key>
                    <md:Value>The temperature of the Magnetometer module</md:Value>
                    <md:DataTypeName>String</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The Description of the Temperature channel</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.Colour.Temperature</md:Key>
                    <md:Value>r=255 g=000 b=000</md:Value>
                    <md:DataTypeName>ColourData</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The Colour of the Temperature channel graph</md:Description>
                </PluginMetadata>

                <!-- Channel 0 -->
                <PluginMetadata>
                    <md:Key>Observation.Channel.Name.0</md:Key>
                    <md:Value>A Component</md:Value>
                    <md:DataTypeName>String</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The name of channel 0</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.DataType.0</md:Key>
                    <md:Value>DecimalInteger</md:Value>
                    <md:DataTypeName>DataType</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The DataType of channel 0</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.Units.0</md:Key>
                    <md:Value>Dimensionless</md:Value>
                    <md:DataTypeName>Units</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The Units of channel 0</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.Description.0</md:Key>
                    <md:Value>The output from the Magnetometer A channel</md:Value>
                    <md:DataTypeName>String</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The Description of channel 0</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.Colour.0</md:Key>
                    <md:Value>r=000 g=255 b=000</md:Value>
                    <md:DataTypeName>ColourData</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The Colour of the A Channel graph</md:Description>
                </PluginMetadata>

                <!-- Channel 1 -->
                <PluginMetadata>
                    <md:Key>Observation.Channel.Name.1</md:Key>
                    <md:Value>B Component</md:Value>
                    <md:DataTypeName>String</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The name of channel 1</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.DataType.1</md:Key>
                    <md:Value>DecimalInteger</md:Value>
                    <md:DataTypeName>DataType</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The DataType of channel 1</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.Units.1</md:Key>
                    <md:Value>Dimensionless</md:Value>
                    <md:DataTypeName>Units</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The Units of channel 1</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.Description.1</md:Key>
                    <md:Value>The output from the Magnetometer B channel</md:Value>
                    <md:DataTypeName>String</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The Description of channel 1</md:Description>
                </PluginMetadata>

                <PluginMetadata>
                    <md:Key>Observation.Channel.Colour.1</md:Key>
                    <md:Value>r=000 g=000 b=255</md:Value>
                    <md:DataTypeName>ColourData</md:DataTypeName>
                    <md:Units>Dimensionless</md:Units>
                    <md:Description>The Colour of the B Channel graph</md:Description>
                </PluginMetadata>

                <!-- The DataCapture Plugin is always CommandCodeBase 03 -->
                <CommandCodeBase>03</CommandCodeBase>

                <Command>
                    <Identifier>getSpace</Identifier>
                    <CommandCode>00</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <Description>Gets the percentage of available storage remaining</Description>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Space</Name>
                        <DataTypeName>DecimalInteger</DataTypeName>
                        <Units>%</Units>
                        <Regex>^([0-9][0-9][0-9])$</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>getData</Identifier>
                    <CommandCode>01</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <BlockedDataCommand>
                        <BlockCountCommandCode>02</BlockCountCommandCode>
                        <BlockCommandCode>03</BlockCommandCode>
                    </BlockedDataCommand>
                    <Description>Gets the data produced by the Instrument</Description>
                    <Category>Capture</Category>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>Staribus</Choices>
                        <Tooltip>Allowed values: Staribus</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Capture.Filter</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>!FilterList</Choices>
                        <Tooltip>Select a Filter to apply to the RawData to create ProcessedData</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Data.Timestamp</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>^(19|20)\d\d([-])(0[1-9]|1[012])\2(0[1-9]|[12][0-9]|3[01]) (([0-1][0-9]|[2][0-3])):([0-5][0-9]):([0-5][0-9])$</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>getDataBlockCount</Identifier>
                    <CommandCode>02</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <BlockedDataCommand>
                        <ParentCommandCode>01</ParentCommandCode>
                    </BlockedDataCommand>
                    <Description>Gets the number of blocks in the Instrument data</Description>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Data.BlockCount</Name>
                        <DataTypeName>HexInteger</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>[0-9A-Fa-f][0-9A-Fa-f][0-9A-Fa-f][0-9A-Fa-f]</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>getDataBlock</Identifier>
                    <CommandCode>03</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <BlockedDataCommand>
                        <ParentCommandCode>01</ParentCommandCode>
                    </BlockedDataCommand>
                    <Description>Gets the specified block of Instrument data</Description>
                    <Parameter>
                        <Name>Data.BlockID</Name>
                        <InputDataType>
                            <DataTypeName>HexInteger</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Regex>[0-9A-Fa-f][0-9A-Fa-f][0-9A-Fa-f][0-9A-Fa-f]</Regex>
                        <Tooltip>Allowed Values: BlockID 0000 to FFFF</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Data.Block</Name>
                        <!-- A special DataType for Staribus timestamped blocks -->
                        <!-- The DataCapture Metadata must describe how to parse the data channels -->
                        <DataTypeName>StaribusBlock</DataTypeName>
                        <Units>Dimensionless</Units>
                    </Response>
                </Command>

                <Command>
                    <Identifier>getRate</Identifier>
                    <CommandCode>04</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <Description>Get the data capture sampling rate</Description>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Data.SampleRate</Name>
                        <DataTypeName>DecimalInteger</DataTypeName>
                        <Units>Seconds</Units>
                        <Regex>^([0-9][0-9][0-9][0-9])$</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>setRate</Identifier>
                    <CommandCode>05</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <Description>Set the data capture sampling rate</Description>
                    <Parameter>
                        <Name>SampleRate</Name>
                        <InputDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <!-- Staribus Decimal integers are always four digits 0000...9999 -->
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </TrafficDataType>
                        <Units>Seconds</Units>
                        <!-- Limit the range to 0001 to 0255 seconds -->
                        <!-- See:http://utilitymill.com/utility/Regex_For_Range -->
                        <Regex>^0*([1-9][0-9]?|1[0-9]{2}|2[0-4][0-9]|25[0-5])$</Regex>
                        <Tooltip>Allowed Values: 1 to 255 seconds</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Ack>
                        <Name>Ack</Name>
                    </Ack>
                </Command>

                <Command>
                    <Identifier>capture</Identifier>
                    <CommandCode>06</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <Description>Starts or stops data capture</Description>
                    <Parameter>
                        <Name>Run</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Ack>
                        <Name>Ack</Name>
                    </Ack>
                </Command>

                <Command>
                    <Identifier>captureRawDataRealtime</Identifier>
                    <CommandCode>07</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <!-- Obtain the data by iterating MagnetometerPlugin.getRealtimeData() -->
                    <IteratedDataCommand>
                        <IteratedCommandCodeBase>04</IteratedCommandCodeBase>
                        <IteratedCommandCode>01</IteratedCommandCode>
                    </IteratedDataCommand>
                    <Description>Captures the Magnetometer A and B components</Description>
                    <Category>Capture</Category>
                    <Parameter>
                        <Name>SampleInterval</Name>
                        <InputDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </TrafficDataType>
                        <Units>Seconds</Units>
                        <Regex>^0*([1-9][0-9]{0,2}|1000)$</Regex>
                        <Tooltip>The time interval between data samples (1 to 1000 seconds)</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Capture.Period</Name>
                        <InputDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </TrafficDataType>
                        <Units>Seconds</Units>
                        <Regex>^0*([0-9]{1,6}|1000000)$</Regex>
                        <Tooltip>The total time of data capture (0 to 1000000 seconds, 0 is continuous)</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Capture.Filter</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>!FilterList</Choices>
                        <Tooltip>Select a Filter to apply to the RawData to create ProcessedData</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>RealtimeUpdate</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>false,true</Choices>
                        <Tooltip>Controls updates on every sample read. Allowed values: true or false</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>VerboseLogging</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>false,true</Choices>
                        <Tooltip>Controls verbose Command execution logging. Allowed values: true or false</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Logging.Timestamp</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>^(19|20)\d\d([-])(0[1-9]|1[012])\2(0[1-9]|[12][0-9]|3[01]) (([0-1][0-9]|[2][0-3])):([0-5][0-9]):([0-5][0-9])$</Regex>
                    </Response>
                </Command>
            </Plugin>

            <!-- ............................................................................... -->
            <!-- Magnetometer Plugin -->

            <Plugin>
                <Identifier>MagnetometerPlugin</Identifier>
                <Name>Magnetometer Plugin</Name>
                <Description>The Magnetometer Plugin</Description>
                <ResourceKey>MagnetometerPlugin</ResourceKey>

                <!-- The Magnetometer Plugin is always CommandCodeBase 04 -->
                <CommandCodeBase>04</CommandCodeBase>

                <Command>
                    <Identifier>getTemperature</Identifier>
                    <CommandCode>00</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <Description>Gets the Temperature of the Magnetometer Plugin</Description>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Magnetometer.Temperature</Name>
                        <DataTypeName>DecimalFloat</DataTypeName>
                        <Units>Celsius</Units>
                        <!-- (- or +), once or not at all -->
                        <!-- zero or more digits [0...9] -->
                        <!-- decimal point followed by one or more digits, once or not at all -->
                        <Regex>^(-|\+)?\d*(\.\d+)?$</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>getRealtimeData</Identifier>
                    <CommandCode>01</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <!-- Link back to DataCapture.captureRawDataRealtime() -->
                    <IteratedDataCommand>
                        <ParentCommandCodeBase>03</ParentCommandCodeBase>
                        <ParentCommandCode>07</ParentCommandCode>
                    </IteratedDataCommand>
                    <Description>Gets the realtime output of the Magnetometer Plugin</Description>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Realtime</Name>
                        <DataTypeName>StaribusMultichannelData</DataTypeName>
                        <Units>Dimensionless</Units>
                        <!-- We know there must be one channel of DecimalFloat followed by 2 channels of DecimalIntegers, -->
                        <!-- each channel separated by Ascii.RS (1E hex) -->
                        <!-- i.e. Temperature, Aaxis, Baxis -->
                        <!-- (- or +), once or not at all -->
                        <!-- zero or more digits [0...9] -->
                        <!-- decimal point followed by one or more digits, once or not at all -->

                        <!-- Normally: -->
                        <!-- 0...2500 0*([0-9]{1,3}|1[0-9]{3}|2[0-4][0-9]{2}|2500)               -->
                        <!-- 0...2047 0*([0-9]{1,3}|1[0-9]{3}|20[0-3][0-9]|204[0-7])             -->
                        <!-- 0...1023 0*([0-9]{1,3}|10[01][0-9]|102[0-3])                        -->
                        <!-- 0...512  0*([0-9]{1,2}|[1-4][0-9]{2}|50[0-9]|51[0-2])               -->
                        <!-- The Magnetometer actually produces -512...0...+511 -->

                        <!-- NOTE - the *order* seems to be important, so use the SECOND expression here! -->

                        <!-- 0...512  0*([0-9]{1,2}|[1-4][0-9]{2}|50[0-9]|51[0-2])               -->
                        <!-- 0...512  0*([1-4][0-9]{2}|50[0-9]|51[0-2]|[0-9]{1,2})               -->

                        <!-- 0...2047 0*([0-9]{1,3}|1[0-9]{3}|20[0-3][0-9]|204[0-7])             -->
                        <!-- 0...2047 0*(1[0-9]{3}|20[0-3][0-9]|204[0-7]|[0-9]{1,3})             -->

                        <Regex>^(-|\+)?\d*(\.\d+)?\x1E(-|\+)?0*(1[0-9]{3}|20[0-3][0-9]|204[0-7]|[0-9]{1,3})\x1E(-|\+)?0*(1[0-9]{3}|20[0-3][0-9]|204[0-7]|[0-9]{1,3})$</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>getGain</Identifier>
                    <CommandCode>02</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <Description>Gets the Gain setting of the Magnetometer amplifier</Description>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Gain</Name>
                        <DataTypeName>DecimalDigit</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>^0*[1-4]$</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>setGain</Identifier>
                    <CommandCode>03</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <Description>Set the Gain of the Magnetometer amplifier</Description>
                    <Parameter>
                        <Name>Gain</Name>
                        <InputDataType>
                            <DataTypeName>DecimalDigit</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>DecimalDigit</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>1,2,3,4</Choices>
                        <Tooltip>Allowed Values: 1, 2, 3, 4</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Ack>
                        <Name>Ack</Name>
                    </Ack>
                </Command>

                <Command>
                    <Identifier>getAAxis</Identifier>
                    <CommandCode>04</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <Description>Gets the A component of the Magnetometer output</Description>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Axis.A</Name>
                        <DataTypeName>DecimalInteger</DataTypeName>
                        <Units>Dimensionless</Units>
                    </Response>
                </Command>

                <Command>
                    <Identifier>getBAxis</Identifier>
                    <CommandCode>05</CommandCode>
                    <CommandVariant>0006</CommandVariant>  <!-- CHANGED -->
                    <Description>Gets the B component of the Magnetometer output</Description>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Axis.B</Name>
                        <DataTypeName>DecimalInteger</DataTypeName>
                        <Units>Dimensionless</Units>
                    </Response>
                </Command>

                <!-- CHANGED NEW COMMAND -->
                <Command>
                    <Identifier>autoNull</Identifier>
                    <CommandCode>06</CommandCode>
                    <CommandVariant>0006</CommandVariant>
                    <Description>Runs the Auto Null routine to set up the Magnetometer</Description>
                    <SendToPort>true</SendToPort>
                    <Ack>
                        <Name>Ack</Name>
                    </Ack>
                </Command>

            </Plugin>

            <!-- ............................................................................... -->
            <!-- MetadataManager Plugin -->

            <Plugin>
                <!-- A virtual Plugin -->
                <Identifier>MetadataManager</Identifier>
                <Name>MetadataManager</Name>
                <Description>The MetadataManager Module</Description>
                <ResourceKey>MetadataManager</ResourceKey>

                <!-- The MetadataManager Plugin is always CommandCodeBase 58 -->
                <CommandCodeBase>58</CommandCodeBase>

                <Command>
                    <Identifier>importMetadata</Identifier>
                    <CommandCode>00</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Import the selected Metadata</Description>
                    <Parameter>
                        <Name>MetadataType</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>Framework,Observatory,Observer,Observation,Instrument,Controller,!PluginList</Choices>
                        <Tooltip>Allowed values: Framework, Observatory, Observer, Observation, Instrument, Controller, All Plugins</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                    </Response>
                </Command>

                <Command>
                    <Identifier>importMetadataLocal</Identifier>
                    <CommandCode>01</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Import a custom Metadata file from the local file system</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>workspace</Value>
                        <Tooltip>The filename of the Metadata to be imported</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>setMetadataValue</Identifier>
                    <CommandCode>02</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Set the Value of the selected Metadata item</Description>
                    <Parameter>
                        <Name>Metadata.Key</Name>
                        <InputDataType>
                            <DataTypeName>MetadataKey</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Tooltip>A Metadata Key valid for the current Instrument and dataset</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Metadata.Value</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Tooltip>The requested new Value of the Metadata</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>addToposWMMMetadata</Identifier>
                    <CommandCode>03</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <!-- See: http://www.ngdc.noaa.gov/geomag/WMM/soft.shtml -->
                    <Description>Add World Magnetic Model Topocentric Metadata</Description>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                    </Response>
                </Command>

                <Command>
                    <Identifier>exportMetadata</Identifier>
                    <CommandCode>04</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Saves the current MetaData in the specified file and format</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive/Metadata</Value>
                        <Tooltip>The pathname/filename to be saved without file extension e.g. archive/Metadata</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Timestamp</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false, to control the addition of a timestamp to the filename</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Choices>
                        <Tooltip>Allowed values: CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>removeMetadata</Identifier>
                    <CommandCode>05</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Remove the selected Metadata</Description>
                    <Parameter>
                        <Name>MetadataType</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>Framework,Observatory,Observer,Observation,Instrument,MetadataMetadata</Choices>
                        <Tooltip>Allowed values: Framework, Observatory, Observer, Observation, Instrument (all), MetadataMetadata</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                    </Response>
                </Command>

                <Command>
                    <Identifier>importPointsOfInterest</Identifier>
                    <CommandCode>06</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Import the selected PointsOfInterest and LinesOfInterest</Description>
                    <Parameter>
                        <Name>PointOfInterestType</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>Framework,Observatory,Instrument</Choices>
                        <Tooltip>Allowed values: Framework, Observatory, Instrument</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                    </Response>
                </Command>

                <Command>
                    <Identifier>removePointsOfInterest</Identifier>
                    <CommandCode>07</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Remove the selected PointsOfInterest and LinesOfInterest</Description>
                    <Parameter>
                        <Name>PointOfInterestType</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>Framework,Observatory,Instrument</Choices>
                        <Tooltip>Allowed values: Framework, Observatory, Instrument</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                    </Response>
                </Command>

            </Plugin>

            <!-- ............................................................................... -->
            <!-- Importer Plugin -->

            <Plugin>
                <!-- A virtual Plugin -->
                <Identifier>Importer</Identifier>
                <Name>Importer</Name>
                <Description>The Importer Module</Description>
                <ResourceKey>Importer</ResourceKey>

                <CommandCodeBase>80</CommandCodeBase>

                <Command>
                    <Identifier>importRawDataLocal</Identifier>
                    <CommandCode>00</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Get a single Magnetometer file from the local file system</Description>
                    <Category>Import</Category>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Tooltip>The filename to be processed</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata,RadioSkyPipe,JohnCook</Choices>
                        <Tooltip>Allowed values: FormattedStardata,CompressedStardata,RadioSkyPipe,CommaSeparated,TabSeparated,JohnCook</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Import.Filter</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>!FilterList</Choices>
                        <Tooltip>Select a Filter to apply to the RawData to create ProcessedData</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>
            </Plugin>

            <!-- ............................................................................... -->
            <!-- Exporter Plugin -->

            <Plugin>
                <!-- A virtual Plugin -->
                <Identifier>Exporter</Identifier>
                <Name>Exporter</Name>
                <Description>The Exporter Module</Description>
                <ResourceKey>Exporter</ResourceKey>

                <CommandCodeBase>81</CommandCodeBase>

                <Command>
                    <Identifier>exportCommandLog</Identifier>
                    <CommandCode>00</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Saves the Command Log in the specified file</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive/CommandLog</Value>
                        <Tooltip>The pathname/filename to be saved without file extension e.g. archive/CommandLog</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Timestamp</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false, to control the addition of a timestamp to the filename</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Choices>
                        <Tooltip>Allowed values: CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>exportChart</Identifier>
                    <CommandCode>01</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Saves the current chart as an image in the specified file</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive/Chart</Value>
                        <Tooltip>The pathname/filename to be saved without file extension e.g. archive/Chart</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Timestamp</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false, to control the addition of a timestamp to the filename</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>png,jpg</Choices>
                        <Tooltip>Allowed values: JPG, PNG (PNG preferred)</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Width</Name>
                        <InputDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Regex>^0*(3[2-9]|[4-9][0-9]|[1-9][0-9]{2}|[12][0-9]{3}|3000)$</Regex>
                        <Value>1024</Value>
                        <Tooltip>The width of the image in pixels (32 to 3000)</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Height</Name>
                        <InputDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Regex>^0*(3[2-9]|[4-9][0-9]|[1-9][0-9]{2}|[12][0-9]{3}|3000)$</Regex>
                        <Value>768</Value>
                        <Tooltip>The height of the image in pixels (32 to 3000)</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>exportProcessedData</Identifier>
                    <CommandCode>02</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Saves the current processed data in the specified file and format</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive/ProcessedData</Value>
                        <Tooltip>The pathname/filename to be saved without file extension e.g. archive/ProcessedData</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Timestamp</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false, to control the addition of a timestamp to the filename</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Choices>
                        <Tooltip>Allowed values: CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>exportRawData</Identifier>
                    <CommandCode>03</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Saves the current raw data in the specified file and format</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive/RawData</Value>
                        <Tooltip>The pathname/filename to be saved without file extension e.g. archive/RawData</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Timestamp</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false, to control the addition of a timestamp to the filename</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Choices>
                        <Tooltip>Allowed values: CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>exportMetadata</Identifier>
                    <CommandCode>04</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Saves the current MetaData in the specified file and format</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive/Metadata</Value>
                        <Tooltip>The pathname/filename to be saved without file extension e.g. archive/Metadata</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Timestamp</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false, to control the addition of a timestamp to the filename</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Choices>
                        <Tooltip>Allowed values: CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Tooltip>


                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>exportEventLog</Identifier>
                    <CommandCode>05</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Saves the current Event Log in the specified file and format</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive/EventLog</Value>
                        <Tooltip>The pathname/filename to be saved without file extension e.g. archive/EventLog</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Timestamp</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false, to control the addition of a timestamp to the filename</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Choices>
                        <Tooltip>Allowed values: CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Tooltip>


                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>exportRegionalMap</Identifier>
                    <CommandCode>06</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Saves the current Regional Map as an image in the specified file</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive/RegionalMap</Value>
                        <Tooltip>The pathname/filename to be saved without file extension e.g. archive/RegionalMap</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Timestamp</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false, to control the addition of a timestamp to the filename</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>png,jpg,gif</Choices>
                        <Tooltip>Allowed values: PNG, JPG, GIF</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>exportConfiguration</Identifier>
                    <CommandCode>07</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Saves the current Instrument configuration in the specified file and format</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive/Configuration</Value>
                        <Tooltip>The pathname/filename to be saved without file extension e.g. archive/Configuration</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Timestamp</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false, to control the addition of a timestamp to the filename</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Choices>
                        <Tooltip>Allowed values: CommaSeparated,TabSeparated,FormattedStardata,CompressedStardata</Tooltip>


                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>exportCommandLexicon</Identifier>
                    <CommandCode>08</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Saves the Instrument Command Lexicon in the specified file</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive/CommandLexicon</Value>
                        <Tooltip>The pathname/filename to be saved without file extension e.g. archive/CommandLexicon</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Timestamp</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false, to control the addition of a timestamp to the filename</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Format</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>CommaSeparated,TabSeparated</Choices>
                        <Tooltip>Allowed values: CommaSeparated,TabSeparated</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>exportInstrumentXML</Identifier>
                    <CommandCode>09</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Saves the Instrument XML in the specified file</Description>
                    <Parameter>
                        <Name>Filename</Name>
                        <InputDataType>
                            <DataTypeName>FileName</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <!-- ToDo Regex -->
                        <Value>archive/InstrumentXML</Value>
                        <Tooltip>The pathname/filename to be saved without file extension e.g. archive/InstrumentXML</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Timestamp</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>true,false</Choices>
                        <Tooltip>Allowed values: true or false, to control the addition of a timestamp to the filename</Tooltip>
                    </Parameter>
                    <SendToPort>false</SendToPort>
                    <Response>
                        <Name>Ack</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>Ok</Regex>
                    </Response>
                </Command>
            </Plugin>

            <!-- ............................................................................... -->
            <!-- Controller and Secondary Plugins -->
            <!-- ............................................................................... -->

            <!-- ............................................................................... -->
            <!-- Analogue Plugin -->

            <Plugin>
                <!-- A virtual Plugin -->
                <Identifier>Analogue</Identifier>
                <Name>Analogue</Name>
                <Description>The Magnetometer's Analogue facilities</Description>
                <ResourceKey>Analogue</ResourceKey>

                <!-- The Analogue Plugin has a CommandCodeBase of 02 -->
                <CommandCodeBase>02</CommandCodeBase>

                <Command>
                    <Identifier>getA2D</Identifier>
                    <CommandCode>00</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Gets the voltage read by the selected A2D channel</Description>
                    <Parameter>
                        <Name>A2D.Channel</Name>
                        <InputDataType>
                            <DataTypeName>UnsignedDecimalByte</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <!-- Staribus Decimal bytes are always three digits 000...255 -->
                            <DataTypeName>UnsignedDecimalByte</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Regex>^[0-7]$</Regex>
                        <Tooltip>Allowed Values: Channels 0 to 7</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>A2D.Value</Name>
                        <DataTypeName>DecimalInteger</DataTypeName>
                        <Units>mV</Units>
                        <Regex>^0*([0-9]{1,3}|1[0-9]{3}|2[0-4][0-9]{2}|2500)$</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>getD2A</Identifier>
                    <CommandCode>01</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Gets the voltage output by the selected D2A channel</Description>
                    <Parameter>
                        <Name>D2A.Channel</Name>
                        <InputDataType>
                            <DataTypeName>UnsignedDecimalByte</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <!-- Staribus Decimal bytes are always three digits 000...255 -->
                            <DataTypeName>UnsignedDecimalByte</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Regex>^[0|1]$</Regex>
                        <Tooltip>Allowed Values: Channels 0 or 1</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>D2A.Value</Name>
                        <DataTypeName>DecimalInteger</DataTypeName>
                        <Units>mV</Units>
                        <Regex>^0*([0-9]{1,3}|1[0-9]{3}|2[0-4][0-9]{2}|2500)$</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>setD2A</Identifier>
                    <CommandCode>02</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Sets the voltage to be output by the selected D2A channel</Description>
                    <Parameter>
                        <Name>D2A.Channel</Name>
                        <InputDataType>
                            <DataTypeName>UnsignedDecimalByte</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <!-- Staribus Decimal bytes are always three digits 000...255 -->
                            <DataTypeName>UnsignedDecimalByte</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Regex>^[0|1]$</Regex>
                        <Tooltip>Allowed Values: Channels 0 or 1</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>D2A.Value</Name>
                        <InputDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <!-- Staribus Decimal integers are always four digits 0000...9999 -->
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </TrafficDataType>
                        <Units>mV</Units>
                        <Regex>^0*([0-9]{1,3}|1[0-9]{3}|2[0-4][0-9]{2}|2500)$</Regex>
                        <Tooltip>Allowed Values: 0000 to 2500 milliVolts</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Ack>
                        <Name>Ack</Name>
                    </Ack>
                </Command>
            </Plugin>

            <!-- ............................................................................... -->
            <!-- Utilities Plugin -->

            <Plugin>
                <!-- A virtual Plugin -->
                <Identifier>Utilities</Identifier>
                <Name>Utilities</Name>
                <Description>The Utilities Module</Description>
                <ResourceKey>Utilities</ResourceKey>

                <!-- The Utilities Plugin is always CommandCodeBase 01 -->
                <CommandCodeBase>01</CommandCodeBase>

                <Command>
                    <Identifier>getClockDate</Identifier>
                    <CommandCode>00</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Gets the Date from the Controller clock</Description>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Clock.Date</Name>
                        <DataTypeName>Date</DataTypeName>
                        <Units>YearMonthDay</Units>
                        <Regex>^(19|20)\d\d([-])(0[1-9]|1[012])\2(0[1-9]|[12][0-9]|3[01])$</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>setClockDate</Identifier>
                    <CommandCode>01</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Sets the Date on the Controller clock</Description>
                    <Parameter>
                        <Name>Clock.Date</Name>
                        <InputDataType>
                            <DataTypeName>Date</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>YearMonthDay</Units>
                        <Regex>^(19|20)\d\d([-])(0[1-9]|1[012])\2(0[1-9]|[12][0-9]|3[01])$</Regex>
                        <Tooltip>Format YYYY-MM-DD</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Ack>
                        <Name>Ack</Name>
                    </Ack>
                </Command>

                <Command>
                    <Identifier>getClockTime</Identifier>
                    <CommandCode>02</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Gets the Time from the Controller clock</Description>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Clock.Time</Name>
                        <DataTypeName>Time</DataTypeName>
                        <Units>HourMinSec</Units>
                        <Regex>^(([0-1][0-9])|([2][0-3])):([0-5][0-9]):([0-5][0-9])$</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>setClockTime</Identifier>
                    <CommandCode>03</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Sets the Time on the Controller clock</Description>
                    <Parameter>
                        <Name>Clock.Time</Name>
                        <InputDataType>
                            <DataTypeName>Time</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>HourMinSec</Units>
                        <Regex>^(([0-1][0-9]|[2][0-3])):([0-5][0-9]):([0-5][0-9])$</Regex>
                        <Tooltip>Format HH:MM:SS</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Ack>
                        <Name>Ack</Name>
                    </Ack>
                </Command>

                <Command>
                    <Identifier>getTemperature</Identifier>
                    <CommandCode>04</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Gets the Temperature of the Controller</Description>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>Controller.Temperature</Name>
                        <DataTypeName>DecimalFloat</DataTypeName>
                        <Units>Celsius</Units>
                        <!-- (- or +), once or not at all -->
                        <!-- zero or more digits [0...9] -->
                        <!-- decimal point followed by one or more digits, once or not at all -->
                        <Regex>^(-|\+)?\d*(\.\d+)?$</Regex>
                    </Response>
                </Command>

                <!-- Low-level developer functions! -->
                <Command>
                    <Identifier>getMemoryPage</Identifier>
                    <CommandCode>05</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Gets the specified page from the EEPROM memory</Description>
                    <Parameter>
                        <Name>ModuleAddress</Name>
                        <InputDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>UnsignedHexByte</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Regex>[0-7]</Regex>
                        <Tooltip>Allowed Values: 0 to 7 (0 is the Controller, 1 the Primary Plugin)</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>PageNumber</Name>
                        <InputDataType>
                            <DataTypeName>UnsignedHexByte</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>UnsignedHexByte</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Regex>^[0-9A-Fa-f][0-9A-Fa-f]$</Regex>
                        <Tooltip>Allowed Values: 00 to FF Hex</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Response>
                        <Name>MemoryPage</Name>
                        <DataTypeName>String</DataTypeName>
                        <Units>Dimensionless</Units>
                        <Regex>^\p{ASCII}{256}$</Regex>
                    </Response>
                </Command>

                <Command>
                    <Identifier>setMemoryPage</Identifier>
                    <CommandCode>06</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Sets the data into the specified page in the EEPROM memory</Description>
                    <Parameter>
                        <Name>ModuleAddress</Name>
                        <InputDataType>
                            <DataTypeName>DecimalInteger</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>UnsignedHexByte</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Regex>[0-7]</Regex>
                        <Tooltip>Allowed Values: 0 to 7 (0 is the Controller, 1 the Primary Plugin)</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>PageNumber</Name>
                        <InputDataType>
                            <DataTypeName>UnsignedHexByte</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>UnsignedHexByte</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Regex>^[0-9A-Fa-f][0-9A-Fa-f]$</Regex>
                        <Tooltip>Allowed Values: 00 to FF Hex</Tooltip>
                    </Parameter>
                    <Parameter>
                        <Name>Data</Name>
                        <InputDataType>
                            <DataTypeName>String</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>String</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Regex>^\p{Graph}{256}$</Regex>
                        <Tooltip>The data must contain exactly 256 ASCII characters</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Ack>
                        <Name>Ack</Name>
                    </Ack>
                </Command>

                <Command>
                    <Identifier>copyResponseToClipboard</Identifier>
                    <CommandCode>07</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Copies the most recent ResponseValue to the host Clipboard</Description>
                    <SendToPort>false</SendToPort>
                    <Ack>
                        <Name>Ack</Name>
                    </Ack>
                </Command>

                <Command>
                    <Identifier>enableBacklight</Identifier>
                    <CommandCode>08</CommandCode>
                    <CommandVariant>0000</CommandVariant>
                    <Description>Controls the LCD Display backlight</Description>
                    <Parameter>
                        <Name>EnableBacklight</Name>
                        <InputDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </InputDataType>
                        <TrafficDataType>
                            <DataTypeName>Boolean</DataTypeName>
                        </TrafficDataType>
                        <Units>Dimensionless</Units>
                        <Choices>false,true</Choices>
                        <Tooltip>Controls the LCD Display backlight. Allowed values: true or false</Tooltip>
                    </Parameter>
                    <SendToPort>true</SendToPort>
                    <Ack>
                        <Name>Ack</Name>
                    </Ack>
                </Command>
            </Plugin>
        </Controller>

        <Name>Staribus AutoNull Magnetometer</Name> <!-- CHANGED -->
        <Description>Dual Axis Magnetoresistive Magnetometer with AutoNull</Description>  <!-- CHANGED -->
        <InstrumentClassname>org.lmn.fc.frameworks.starbase.plugins.observatory.ui.instruments.impl.staribusmagnetometer.Magnetometer</InstrumentClassname>
        <Controllable>true</Controllable>
        <SelectorPanelHeight>1</SelectorPanelHeight>

        <ResourceKey>MagnetometerAutoNull</ResourceKey> <!-- CHANGED -->

        <!-- The Data Access Object is the Java interface from the Host PC to the Controller -->
        <!-- In this case via the RS485 on a COM port as defined in properties-Staribus.xml -->
        <DAO>
            <Name>Magnetometer</Name>
            <Description>This DAO controls a local Magnetometer on Staribus</Description>
            <DaoClassname>org.lmn.fc.frameworks.starbase.plugins.observatory.ui.instruments.impl.staribusmagnetometer.dao.StaribusMagnetometerDAO</DaoClassname>

            <!-- The DAO Port (possibly multiple Ports one day! -->
            <!-- The Port is either a unique instance for this DAO, -->
            <!-- OR a use of the Observatory StaribusPort -->

            <StaribusPort>Observatory</StaribusPort>

            <!-- The DAO has no Inputs -->

            <!-- DAO Outputs -->
            <Output>
                <Name>CommandLog</Name>
                <Description>The Command Log produced by the DAO</Description>
                <Tooltip>The Command Log</Tooltip>
                <DataTypeName>ListData</DataTypeName>
                <Units>Dimensionless</Units>
            </Output>
            <Output>
                <Name>ProcessedData</Name>
                <Description>The Processed Data produced by the DAO</Description>
                <Tooltip>The XYDataset (processed)</Tooltip>
                <DataTypeName>XYDataset</DataTypeName>
                <Units>Dimensionless</Units>
            </Output>
            <Output>
                <Name>RawData</Name>
                <Description>The Raw Data produced by the DAO</Description>
                <Tooltip>The Raw Data (unprocessed)</Tooltip>
                <DataTypeName>VectorData</DataTypeName>
                <Units>Dimensionless</Units>
            </Output>
            <Output>
                <Name>EventLog</Name>
                <Description>The Event Log produced by the DAO</Description>
                <Tooltip>The Event Log</Tooltip>
                <DataTypeName>VectorData</DataTypeName>
                <Units>Dimensionless</Units>
            </Output>
            <Output>
                <Name>MetaData</Name>
                <Description>The Meta Data produced by the DAO</Description>
                <Tooltip>The Meta Data</Tooltip>
                <DataTypeName>ListData</DataTypeName>
                <Units>Dimensionless</Units>
            </Output>
            <Output>
                <Name>Configuration</Name>
                <Description>The Configuration produced by the DAO</Description>
                <Tooltip>The Configuration</Tooltip>
                <DataTypeName>ListData</DataTypeName>
                <Units>Dimensionless</Units>
            </Output>
            <Output>
                <Name>CommandLexicon</Name>
                <Description>The Instrument Command Lexicon produced by the DAO</Description>
                <Tooltip>The Instrument Command Lexicon</Tooltip>
                <DataTypeName>ListData</DataTypeName>
                <Units>Dimensionless</Units>
            </Output>
            <Output>
                <Name>XML</Name>
                <Description>The Instrument XML Configuration produced by the DAO</Description>
                <Tooltip>The Instrument XML Configuration</Tooltip>
                <DataTypeName>XML</DataTypeName>
                <Units>Dimensionless</Units>
            </Output>
        </DAO>
    </Instrument>

</Instruments>
